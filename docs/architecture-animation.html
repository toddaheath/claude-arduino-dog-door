<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Smart Dog Door - Architecture Animation</title>
<style>
  * { margin: 0; padding: 0; box-sizing: border-box; }
  body {
    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
    background: #0f172a;
    color: #e2e8f0;
    min-height: 100vh;
    overflow-x: hidden;
  }
  h1 {
    text-align: center;
    padding: 24px 0 8px;
    font-size: 1.8rem;
    background: linear-gradient(135deg, #38bdf8, #818cf8);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
  }
  .subtitle {
    text-align: center;
    color: #64748b;
    font-size: 0.9rem;
    margin-bottom: 16px;
  }
  .canvas {
    position: relative;
    width: 1100px;
    height: 620px;
    margin: 0 auto;
  }

  /* ---- Boxes ---- */
  .box {
    position: absolute;
    border-radius: 12px;
    padding: 14px 18px;
    text-align: center;
    transition: box-shadow 0.4s, transform 0.3s;
  }
  .box.active {
    transform: scale(1.05);
    z-index: 10;
  }
  .box .icon { font-size: 1.6rem; margin-bottom: 4px; }
  .box .label { font-weight: 600; font-size: 0.85rem; }
  .box .detail { font-size: 0.7rem; color: #94a3b8; margin-top: 2px; }

  /* Zones */
  .zone {
    position: absolute;
    border: 1.5px dashed;
    border-radius: 16px;
    padding: 10px;
  }
  .zone .zone-title {
    position: absolute;
    top: -12px;
    left: 18px;
    font-size: 0.75rem;
    font-weight: 700;
    text-transform: uppercase;
    letter-spacing: 1px;
    padding: 0 8px;
  }

  /* ESP32 zone */
  .zone-esp {
    left: 20px; top: 60px;
    width: 420px; height: 540px;
    border-color: #22d3ee44;
    background: #0e293818;
  }
  .zone-esp .zone-title { background: #0f172a; color: #22d3ee; }

  /* Backend zone */
  .zone-backend {
    left: 490px; top: 60px;
    width: 300px; height: 540px;
    border-color: #a78bfa44;
    background: #1e1b4b18;
  }
  .zone-backend .zone-title { background: #0f172a; color: #a78bfa; }

  /* Admin zone */
  .zone-admin {
    left: 840px; top: 60px;
    width: 240px; height: 540px;
    border-color: #34d39944;
    background: #06372018;
  }
  .zone-admin .zone-title { background: #0f172a; color: #34d399; }

  /* Component colors */
  .sensor   { background: #164e63; border: 1.5px solid #22d3ee; }
  .sensor.active { box-shadow: 0 0 20px #22d3ee88; }
  .camera   { background: #1e3a5f; border: 1.5px solid #38bdf8; }
  .camera.active { box-shadow: 0 0 20px #38bdf888; }
  .ml       { background: #3b0764; border: 1.5px solid #c084fc; }
  .ml.active { box-shadow: 0 0 20px #c084fc88; }
  .api-cli  { background: #1e1b4b; border: 1.5px solid #818cf8; }
  .api-cli.active { box-shadow: 0 0 20px #818cf888; }
  .api      { background: #312e81; border: 1.5px solid #a78bfa; }
  .api.active { box-shadow: 0 0 20px #a78bfa88; }
  .db       { background: #1c1917; border: 1.5px solid #f59e0b; }
  .db.active { box-shadow: 0 0 20px #f59e0b88; }
  .storage  { background: #1c1917; border: 1.5px solid #fb923c; }
  .storage.active { box-shadow: 0 0 20px #fb923c88; }
  .door     { background: #14532d; border: 1.5px solid #4ade80; }
  .door.active { box-shadow: 0 0 20px #4ade8088; }
  .spa      { background: #064e3b; border: 1.5px solid #34d399; }
  .spa.active { box-shadow: 0 0 20px #34d39988; }
  .safety   { background: #7f1d1d; border: 1.5px solid #f87171; }
  .safety.active { box-shadow: 0 0 20px #f8717188; }

  /* SVG layer for arrows */
  svg.arrows {
    position: absolute;
    top: 0; left: 0;
    width: 100%; height: 100%;
    pointer-events: none;
  }
  svg.arrows line, svg.arrows path {
    stroke-width: 2;
    fill: none;
    opacity: 0.25;
    transition: opacity 0.4s;
  }
  svg.arrows .arrow-active {
    opacity: 1;
  }

  /* Particle (data packet) */
  .packet {
    position: absolute;
    width: 10px; height: 10px;
    border-radius: 50%;
    pointer-events: none;
    opacity: 0;
    z-index: 20;
  }
  .packet.visible {
    opacity: 1;
    box-shadow: 0 0 8px currentColor;
  }

  /* Narration bar */
  .narration {
    position: absolute;
    bottom: 8px;
    left: 50%;
    transform: translateX(-50%);
    background: #1e293b;
    border: 1px solid #334155;
    border-radius: 8px;
    padding: 10px 24px;
    font-size: 0.85rem;
    min-width: 500px;
    text-align: center;
    transition: opacity 0.4s;
  }
  .narration .step-num {
    display: inline-block;
    background: #818cf8;
    color: #0f172a;
    font-weight: 700;
    font-size: 0.7rem;
    border-radius: 4px;
    padding: 1px 7px;
    margin-right: 6px;
  }

  /* Controls */
  .controls {
    text-align: center;
    padding: 12px 0 24px;
  }
  .controls button {
    background: #1e293b;
    color: #e2e8f0;
    border: 1px solid #475569;
    border-radius: 8px;
    padding: 8px 20px;
    font-size: 0.85rem;
    cursor: pointer;
    margin: 0 6px;
    transition: background 0.2s;
  }
  .controls button:hover { background: #334155; }
  .controls button.primary {
    background: #4f46e5;
    border-color: #6366f1;
  }
  .controls button.primary:hover { background: #6366f1; }
  .controls .speed-label {
    color: #64748b;
    font-size: 0.8rem;
    margin-left: 12px;
  }

  /* Legend */
  .legend {
    display: flex;
    justify-content: center;
    gap: 16px;
    flex-wrap: wrap;
    padding: 0 0 8px;
    font-size: 0.75rem;
    color: #94a3b8;
  }
  .legend span {
    display: flex;
    align-items: center;
    gap: 4px;
  }
  .legend .dot {
    width: 10px;
    height: 10px;
    border-radius: 50%;
    display: inline-block;
  }
</style>
</head>
<body>
<h1>Smart Dog Door - System Architecture</h1>
<p class="subtitle">Animated data flow from edge sensors to admin dashboard</p>

<div class="legend">
  <span><span class="dot" style="background:#22d3ee"></span> Sensors</span>
  <span><span class="dot" style="background:#38bdf8"></span> Camera</span>
  <span><span class="dot" style="background:#c084fc"></span> ML Inference</span>
  <span><span class="dot" style="background:#818cf8"></span> Network</span>
  <span><span class="dot" style="background:#a78bfa"></span> API</span>
  <span><span class="dot" style="background:#f59e0b"></span> Database</span>
  <span><span class="dot" style="background:#4ade80"></span> Door / SPA</span>
  <span><span class="dot" style="background:#f87171"></span> Safety</span>
</div>

<div class="canvas" id="canvas">
  <!-- Zones -->
  <div class="zone zone-esp"><span class="zone-title">ESP32-CAM Edge Device</span></div>
  <div class="zone zone-backend"><span class="zone-title">Backend Server</span></div>
  <div class="zone zone-admin"><span class="zone-title">Admin Interface</span></div>

  <!-- ESP32 components -->
  <div class="box sensor" id="radar" style="left:40px;top:90px;width:120px">
    <div class="icon">üì°</div>
    <div class="label">RCWL-0516</div>
    <div class="detail">Radar (7m range)</div>
  </div>
  <div class="box sensor" id="ultrasonic" style="left:40px;top:190px;width:120px">
    <div class="icon">üìè</div>
    <div class="label">HC-SR04</div>
    <div class="detail">Ultrasonic (&lt;50cm)</div>
  </div>
  <div class="box camera" id="camera" style="left:200px;top:140px;width:120px">
    <div class="icon">üì∑</div>
    <div class="label">OV2640</div>
    <div class="detail">320x240 JPEG</div>
  </div>
  <div class="box ml" id="tflite" style="left:200px;top:260px;width:140px">
    <div class="icon">üß†</div>
    <div class="label">TFLite Micro</div>
    <div class="detail">Dog vs Not-Dog</div>
  </div>
  <div class="box api-cli" id="apiclient" style="left:200px;top:380px;width:140px">
    <div class="icon">üåê</div>
    <div class="label">API Client</div>
    <div class="detail">HTTPS + multipart</div>
  </div>
  <div class="box door" id="actuator" style="left:60px;top:400px;width:110px">
    <div class="icon">üö™</div>
    <div class="label">Actuator</div>
    <div class="detail">12V Linear</div>
  </div>
  <div class="box safety" id="irbeam" style="left:60px;top:310px;width:110px">
    <div class="icon">üî¥</div>
    <div class="label">IR Beam</div>
    <div class="detail">Safety interlock</div>
  </div>
  <div class="box sensor" id="reed" style="left:60px;top:500px;width:110px">
    <div class="icon">üß≤</div>
    <div class="label">Reed Switch</div>
    <div class="detail">Door position</div>
  </div>

  <!-- Backend components -->
  <div class="box api" id="api" style="left:530px;top:180px;width:220px">
    <div class="icon">‚öôÔ∏è</div>
    <div class="label">.NET Web API</div>
    <div class="detail">ASP.NET Core 8 + EF Core 9</div>
  </div>
  <div class="box api" id="phash" style="left:540px;top:300px;width:200px">
    <div class="icon">üîç</div>
    <div class="label">pHash Engine</div>
    <div class="detail">Perceptual hashing ID</div>
  </div>
  <div class="box db" id="postgres" style="left:540px;top:410px;width:95px">
    <div class="icon">üóÑÔ∏è</div>
    <div class="label">PostgreSQL</div>
    <div class="detail">Events + animals</div>
  </div>
  <div class="box storage" id="filestorage" style="left:650px;top:410px;width:95px">
    <div class="icon">üìÅ</div>
    <div class="label">File Store</div>
    <div class="detail">uploads/</div>
  </div>
  <div class="box api" id="direction" style="left:540px;top:510px;width:200px">
    <div class="icon">‚ÜîÔ∏è</div>
    <div class="label">Direction Detection</div>
    <div class="detail">Inside/Outside + Enter/Exit</div>
  </div>

  <!-- Admin components -->
  <div class="box spa" id="spa" style="left:870px;top:160px;width:180px">
    <div class="icon">üñ•Ô∏è</div>
    <div class="label">React SPA</div>
    <div class="detail">Vite + TypeScript</div>
  </div>
  <div class="box spa" id="animals" style="left:880px;top:280px;width:160px">
    <div class="icon">üêï</div>
    <div class="label">Animal Mgmt</div>
    <div class="detail">Profiles + photos</div>
  </div>
  <div class="box spa" id="logs" style="left:880px;top:380px;width:160px">
    <div class="icon">üìã</div>
    <div class="label">Access Logs</div>
    <div class="detail">Event history</div>
  </div>
  <div class="box spa" id="settings" style="left:880px;top:470px;width:160px">
    <div class="icon">‚öôÔ∏è</div>
    <div class="label">Settings</div>
    <div class="detail">Door config</div>
  </div>

  <!-- SVG arrows -->
  <svg class="arrows" viewBox="0 0 1100 620">
    <defs>
      <marker id="ah-cyan" markerWidth="8" markerHeight="6" refX="8" refY="3" orient="auto">
        <polygon points="0 0, 8 3, 0 6" fill="#22d3ee"/>
      </marker>
      <marker id="ah-blue" markerWidth="8" markerHeight="6" refX="8" refY="3" orient="auto">
        <polygon points="0 0, 8 3, 0 6" fill="#38bdf8"/>
      </marker>
      <marker id="ah-purple" markerWidth="8" markerHeight="6" refX="8" refY="3" orient="auto">
        <polygon points="0 0, 8 3, 0 6" fill="#c084fc"/>
      </marker>
      <marker id="ah-indigo" markerWidth="8" markerHeight="6" refX="8" refY="3" orient="auto">
        <polygon points="0 0, 8 3, 0 6" fill="#818cf8"/>
      </marker>
      <marker id="ah-violet" markerWidth="8" markerHeight="6" refX="8" refY="3" orient="auto">
        <polygon points="0 0, 8 3, 0 6" fill="#a78bfa"/>
      </marker>
      <marker id="ah-green" markerWidth="8" markerHeight="6" refX="8" refY="3" orient="auto">
        <polygon points="0 0, 8 3, 0 6" fill="#4ade80"/>
      </marker>
      <marker id="ah-red" markerWidth="8" markerHeight="6" refX="8" refY="3" orient="auto">
        <polygon points="0 0, 8 3, 0 6" fill="#f87171"/>
      </marker>
    </defs>

    <!-- Radar -> Camera -->
    <line id="a1" x1="160" y1="120" x2="200" y2="160" stroke="#22d3ee" marker-end="url(#ah-cyan)"/>
    <!-- Ultrasonic -> Camera -->
    <line id="a2" x1="160" y1="210" x2="200" y2="180" stroke="#22d3ee" marker-end="url(#ah-cyan)"/>
    <!-- Camera -> TFLite -->
    <line id="a3" x1="260" y1="200" x2="270" y2="260" stroke="#38bdf8" marker-end="url(#ah-blue)"/>
    <!-- TFLite -> API Client -->
    <line id="a4" x1="270" y1="320" x2="270" y2="380" stroke="#c084fc" marker-end="url(#ah-purple)"/>
    <!-- API Client -> API -->
    <line id="a5" x1="340" y1="400" x2="530" y2="220" stroke="#818cf8" marker-end="url(#ah-indigo)"/>
    <!-- API -> pHash -->
    <line id="a6" x1="640" y1="240" x2="640" y2="300" stroke="#a78bfa" marker-end="url(#ah-violet)"/>
    <!-- API -> Postgres -->
    <line id="a7" x1="590" y1="240" x2="588" y2="410" stroke="#a78bfa" marker-end="url(#ah-violet)"/>
    <!-- API -> File Storage -->
    <line id="a8" x1="700" y1="240" x2="698" y2="410" stroke="#a78bfa" marker-end="url(#ah-violet)"/>
    <!-- API -> Direction -->
    <line id="a9" x1="640" y1="240" x2="640" y2="510" stroke="#a78bfa" marker-end="url(#ah-violet)"/>
    <!-- API -> API Client (response) -->
    <line id="a10" x1="530" y1="230" x2="340" y2="410" stroke="#4ade80" marker-end="url(#ah-green)"/>
    <!-- API Client -> Actuator -->
    <line id="a11" x1="200" y1="410" x2="170" y2="430" stroke="#4ade80" marker-end="url(#ah-green)"/>
    <!-- IR -> Actuator -->
    <line id="a12" x1="115" y1="370" x2="115" y2="400" stroke="#f87171" marker-end="url(#ah-red)"/>
    <!-- Reed -> Actuator -->
    <line id="a13" x1="115" y1="500" x2="115" y2="465" stroke="#22d3ee" marker-end="url(#ah-cyan)"/>
    <!-- SPA -> API -->
    <line id="a14" x1="870" y1="190" x2="750" y2="200" stroke="#34d399" marker-end="url(#ah-green)"/>
    <!-- API -> SPA -->
    <line id="a15" x1="750" y1="210" x2="870" y2="200" stroke="#a78bfa" marker-end="url(#ah-violet)"/>
  </svg>

  <!-- Data packet elements -->
  <div class="packet" id="pkt1" style="color:#22d3ee; background:#22d3ee"></div>
  <div class="packet" id="pkt2" style="color:#38bdf8; background:#38bdf8"></div>
  <div class="packet" id="pkt3" style="color:#c084fc; background:#c084fc"></div>
  <div class="packet" id="pkt4" style="color:#818cf8; background:#818cf8"></div>
  <div class="packet" id="pkt5" style="color:#a78bfa; background:#a78bfa"></div>
  <div class="packet" id="pkt6" style="color:#4ade80; background:#4ade80"></div>

  <!-- Narration -->
  <div class="narration" id="narration">
    <span class="step-num">READY</span> Press Play to start the animation
  </div>
</div>

<div class="controls">
  <button class="primary" id="btnPlay">&#9654; Play</button>
  <button id="btnPause">&#10074;&#10074; Pause</button>
  <button id="btnReset">&#8634; Reset</button>
  <span class="speed-label">Speed:</span>
  <button id="btnSlow">0.5x</button>
  <button id="btnNormal">1x</button>
  <button id="btnFast">2x</button>
</div>

<script>
(function() {
  const $ = id => document.getElementById(id);
  const boxes = document.querySelectorAll('.box');
  const arrows = document.querySelectorAll('svg.arrows line');
  const narration = $('narration');
  let speed = 1;
  let playing = false;
  let timeouts = [];

  function clearAll() {
    timeouts.forEach(t => clearTimeout(t));
    timeouts = [];
    boxes.forEach(b => b.classList.remove('active'));
    arrows.forEach(a => a.classList.remove('arrow-active'));
    document.querySelectorAll('.packet').forEach(p => {
      p.classList.remove('visible');
      p.style.transition = 'none';
    });
  }

  function delay(ms) {
    return new Promise(resolve => {
      const t = setTimeout(resolve, ms / speed);
      timeouts.push(t);
    });
  }

  function activate(id) { $(id).classList.add('active'); }
  function deactivate(id) { $(id).classList.remove('active'); }
  function arrowOn(id) { $(id).classList.add('arrow-active'); }
  function arrowOff(id) { $(id).classList.remove('arrow-active'); }

  function setNarration(step, text) {
    narration.innerHTML = '<span class="step-num">' + step + '</span> ' + text;
  }

  function movePacket(pktId, x1, y1, x2, y2, dur) {
    const pkt = $(pktId);
    pkt.style.transition = 'none';
    pkt.style.left = x1 + 'px';
    pkt.style.top = y1 + 'px';
    pkt.classList.add('visible');
    // Force reflow
    pkt.offsetHeight;
    pkt.style.transition = 'left ' + (dur/speed) + 'ms linear, top ' + (dur/speed) + 'ms linear';
    pkt.style.left = x2 + 'px';
    pkt.style.top = y2 + 'px';
    return delay(dur).then(() => pkt.classList.remove('visible'));
  }

  async function runAnimation() {
    if (!playing) return;
    clearAll();

    // Step 1: Radar detects motion
    setNarration('1', 'RCWL-0516 radar detects motion up to 7 meters away');
    activate('radar');
    await delay(1200);
    if (!playing) return;

    // Step 2: Ultrasonic confirms proximity
    setNarration('2', 'HC-SR04 ultrasonic confirms animal within 50cm');
    activate('ultrasonic');
    arrowOn('a1');
    arrowOn('a2');
    await delay(1200);
    if (!playing) return;

    // Step 3: Camera captures
    setNarration('3', 'OV2640 camera captures 320x240 JPEG frame');
    activate('camera');
    movePacket('pkt1', 155, 115, 200, 155, 500);
    await delay(600);
    movePacket('pkt1', 155, 205, 200, 175, 500);
    await delay(800);
    if (!playing) return;
    deactivate('radar');
    deactivate('ultrasonic');

    // Step 4: TFLite inference
    setNarration('4', 'TFLite Micro runs quantized MobileNet: dog detected (score > 0.7)');
    arrowOn('a3');
    activate('tflite');
    movePacket('pkt2', 255, 195, 265, 255, 500);
    await delay(1500);
    if (!playing) return;
    deactivate('camera');

    // Step 5: API request
    setNarration('5', 'API Client sends image via HTTPS multipart POST to /api/doors/access-request');
    arrowOn('a4');
    activate('apiclient');
    movePacket('pkt3', 265, 315, 265, 375, 400);
    await delay(600);
    if (!playing) return;
    deactivate('tflite');

    arrowOn('a5');
    activate('api');
    movePacket('pkt4', 335, 395, 525, 215, 800);
    await delay(1000);
    if (!playing) return;

    // Step 6: pHash identification
    setNarration('6', 'API runs perceptual hash comparison against stored animal photos');
    arrowOn('a6');
    activate('phash');
    movePacket('pkt5', 635, 235, 635, 295, 400);
    await delay(800);
    if (!playing) return;

    // Step 6b: Direction detection
    setNarration('6b', 'Direction detection determines entering/exiting based on camera side');
    arrowOn('a9');
    activate('direction');
    await delay(800);
    if (!playing) return;
    deactivate('direction');

    // Step 7: Log to DB + store photo
    setNarration('7', 'Event logged to PostgreSQL, photo saved to filesystem');
    arrowOn('a7');
    arrowOn('a8');
    activate('postgres');
    activate('filestorage');
    movePacket('pkt5', 585, 235, 583, 405, 500);
    await delay(800);
    if (!playing) return;
    deactivate('phash');

    // Step 8: Response to ESP32
    setNarration('8', 'API responds: {allowed: true, animalName: "Buddy", direction: "entering"}');
    arrowOn('a10');
    movePacket('pkt6', 525, 225, 335, 405, 700);
    await delay(1000);
    if (!playing) return;
    deactivate('api');
    deactivate('postgres');
    deactivate('filestorage');

    // Step 9: Door opens
    setNarration('9', 'Linear actuator opens door, IR beam monitors doorway for safe passage');
    arrowOn('a11');
    arrowOn('a12');
    arrowOn('a13');
    activate('actuator');
    activate('irbeam');
    activate('reed');
    movePacket('pkt6', 195, 405, 165, 425, 400);
    await delay(2000);
    if (!playing) return;
    deactivate('apiclient');

    // Step 10: Auto-close
    setNarration('10', 'IR beam clears, door auto-closes after timeout, reed switch confirms position');
    deactivate('irbeam');
    await delay(1500);
    if (!playing) return;
    deactivate('actuator');
    deactivate('reed');

    // Step 11: Admin views
    setNarration('11', 'Admin views events, manages animals, and configures door via React SPA');
    arrowOn('a14');
    arrowOn('a15');
    activate('spa');
    activate('api');
    await delay(600);
    activate('animals');
    await delay(400);
    activate('logs');
    await delay(400);
    activate('settings');
    await delay(1500);
    if (!playing) return;

    // Done
    setNarration('DONE', 'Cycle complete! The door processed an access request in under 2 seconds.');
    deactivate('api');

    await delay(3000);
    if (playing) runAnimation(); // Loop
  }

  $('btnPlay').addEventListener('click', () => {
    if (!playing) { playing = true; runAnimation(); }
  });
  $('btnPause').addEventListener('click', () => {
    playing = false;
    clearAll();
    setNarration('PAUSED', 'Animation paused');
  });
  $('btnReset').addEventListener('click', () => {
    playing = false;
    clearAll();
    setNarration('READY', 'Press Play to start the animation');
  });
  $('btnSlow').addEventListener('click', () => { speed = 0.5; });
  $('btnNormal').addEventListener('click', () => { speed = 1; });
  $('btnFast').addEventListener('click', () => { speed = 2; });
})();
</script>
</body>
</html>
